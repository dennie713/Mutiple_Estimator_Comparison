import numpy as np

def TTD(z1, r):
    # SamplingTime = 0.001
    acc_est = np.zeros(len(z1))
    acc_est[0] = 0
    vel_est = np.zeros(len(z1))
    vel_est[0] = 0
    for i in range(len(z1)):
        if i > 0:
            dz3 = acc_estimator(r[i-1], z1[i-1], vel_est[i-1], acc_est[i-1])
            acc_est[i] = integrate(acc_est[i-1], dz3)
            vel_est[i] = integrate(vel_est[i-1], acc_est[i])
    return acc_est, vel_est

def acc_estimator(r, z1, z2, z3):
    # å¯èª¿æ•´åƒæ•¸
    R = 30
    l1 = 25
    l2 = 15
    l3 = 10
    k1 = 20
    k2 = 1
    k3 = 10
    e = z1 - r
    dz3 = -R**3*(l1*e+sat(k1*e)+l2*z2/R+sat(k2*z2/R)+l3*z3/R**2+sat(k3*z3/R**2))
    return dz3

# Ï: å½±éŸ¿z1(t)ï¼Œz2(t)å’Œz3(t)çš„æ”¶æ–‚å’Œæº–ç¢ºæ€§ç‰¹æ€§
# è¼ƒå°çš„Ïï¼Œæœ‰åŠ©æ–¼å¿«é€Ÿæ”¶æ–‚ï¼Œå°¤å…¶æ˜¯åœ¨æš«æ…‹å’Œé«˜ç²¾åº¦æ™‚ï¼›
# ä½†Ïå¤ªå°å¯èƒ½æœƒå°è‡´æ›´å¤šçš„å¹²æ“¾ï¼Œç‰¹åˆ¥æ˜¯åœ¨è€ƒæ…®é›œè¨Šæ™‚z3(t)ã€‚
# R:
# è¼ƒå¤§çš„Ræœ‰åŠ©æ–¼åŠ é€Ÿæš«æ…‹æ”¶æ–‚ï¼Œä½†æå¤±äº†é›œè¨ŠæŠ‘åˆ¶èƒ½åŠ›ã€‚
# ğ‘™_1 ã€ ğ‘˜_1:
# è¼ƒå¤§çš„ğ‘™_1 ã€ ğ‘˜_1æœ‰åŠ©æ–¼æš«æ…‹éŸ¿æ‡‰å’Œé«˜ç©©æ…‹ä¼°è¨ˆç²¾åº¦ã€‚
# ğ‘™_2 ã€ ğ‘˜_2:ç¢ºä¿æœ€å¹³æ»‘çš„ä¼°è¨ˆ
# è¼ƒå¤§çš„ğ‘™_2 ã€ ğ‘˜_2æœ‰åŠ©æ–¼æœ€å¹³æ»‘çš„ä¼°è¨ˆï¼Œä½†å°æš«æ…‹æœ‰å®³ã€‚
# ğ‘™_3 ã€ ğ‘˜_3:
# è¼ƒå¤§çš„ğ‘™_3 ã€ ğ‘˜_3é¡¯ç„¶å°æ”¹å–„z3(t)çš„æœ€å¹³æ»‘ä¼°è¨ˆèƒ½åŠ›å¾ˆé‡è¦ï¼Œä½†æš«æ…‹å¯èƒ½è¼ƒæ…¢ã€‚

def integrate(x, dx):
    dt = 0.001
    x = x + dx*dt
    return x

def sat(x):
    rho = 0.1
    sat = x/((rho+x**2)**0.5)
    return sat